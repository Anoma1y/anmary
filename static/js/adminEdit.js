"use strict";var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var sizeCheckbox=document.getElementsByName("size_chois"),productId=document.getElementById("productId"),productComposition=document.getElementById("productComposition"),productSize=document.getElementById("productSize"),productTitle=document.getElementById("productTitle"),productArticle=document.getElementById("productArticle"),productCategory=document.getElementById("productCategory"),productBrand=document.getElementById("productBrand"),productSeason=document.getElementById("productSeason"),productIsSale=document.getElementById("productIsSale"),productPercent=document.getElementById("productSalePercent"),productPrice=document.getElementById("productPrice"),productPriceAfterSale=document.getElementById("productPriceAfterSale"),productIsAvailability=document.getElementById("productIsavailability"),addProductBtn=document.getElementById("addProduct"),editProductBtn=document.getElementById("editProduct"),previewImage=document.getElementById("previewImage"),compositions={wool:{ru:"Шерсть",eng:"wool"},polyester:{ru:"Полиэстер",eng:"polyester"},viscose:{ru:"Вискоза",eng:"viscose"},elastane:{ru:"Эластан",eng:"elastane"},cotton:{ru:"Хлопок",eng:"cotton"},polyamide:{ru:"Полиамид",eng:"polyamide"},nylon:{ru:"Нейлон",eng:"nylon"},lyen:{ru:"Лен",eng:"lyen"},silk:{ru:"Шелк",eng:"silk"},acrylic:{ru:"Акрил",eng:"acrylic"},linen:{ru:"Лён",eng:"linen"},angora:{ru:"Ангора",eng:"angora"},polyviskoza:{ru:"Поливискоза",eng:"polyviskoza"},rayon:{ru:"Искусственный шелк",eng:"rayon"},lurex:{ru:"Люрекс",eng:"Lurex"}},sizeName=[40,42,44,46,48,50,52,54,56,58,60],errorText=document.getElementById("error"),successText=document.getElementById("success"),productCompositionArr=[],sizeArr=[],isSaleCheck=!0===productIsSale.checked;function getSale(e,t){return t>=0&&t<=100&&"0"!=t[0]?e-e*(t/100):0}function getPercent(e,t){var o=Math.floor(100-100*t/e);return o<=100&&o>=0?o:"Ошибка"}function getSelected(e){if(e.options)for(var t=0;t<e.options.length;t++)if(e.options[t].selected)return e.options[t].value}function translateBoolToInt(e){return!0===e?1:0}addProductBtn&&addProductBtn.addEventListener("click",ajaxAdd,!1),editProductBtn&&editProductBtn.addEventListener("click",ajaxEdit,!1);function ajaxAdd(e){if(e.preventDefault(),productTitle.value.length>=1&&productArticle.value.length>=1&&productSize.value.length>=1&&productComposition.value.length>=1&&productPercent.value.length>=1&&productPrice.value.length>=1&&productPriceAfterSale.value.length>=1){var t=new XMLHttpRequest,o=document.getElementById("uploadimage").files[0],r=new FormData;t.open("POST","addProduct",!0),r.append("uploadimage",o),r.append("productTitle",productTitle.value),r.append("productArticle",productArticle.value),r.append("productCategory",getSelected(productCategory)),r.append("productBrand",getSelected(productBrand)),r.append("productColour",getSelected(productColour)),r.append("productSeason",getSelected(productSeason)),r.append("productSize",productSize.value),r.append("productComposition",productComposition.value),r.append("productIsSale",translateBoolToInt(productIsSale.checked)),r.append("productPercent",productPercent.value),r.append("productPrice",productPrice.value),r.append("productPriceAfterSale",productPriceAfterSale.value),r.append("productIsAvailability",translateBoolToInt(productIsAvailability.checked)),t.send(r),t.onreadystatechange=function(){4==t.readyState&&(200!=t.status?(console.log(t.status+" : "+t.statusText),errorText.textContent="Ошибка"):1==t.responseText&&(window.location="./"))}}else errorText.textContent="Заполните все поля!"}function ajaxEdit(e){if(e.preventDefault(),productTitle.value.length>=1&&productArticle.value.length>=1&&productSize.value.length>=1&&productComposition.value.length>=1&&productPercent.value.length>=1&&productPrice.value.length>=1&&productPriceAfterSale.value.length>=1){var t=new XMLHttpRequest,o=document.getElementById("uploadimage").files[0],r=new FormData;t.open("POST","../editProduct",!0),r.append("uploadimage",o),r.append("productId",productId.value),r.append("productTitle",productTitle.value),r.append("productArticle",productArticle.value),r.append("productCategory",getSelected(productCategory)),r.append("productBrand",getSelected(productBrand)),r.append("productColour",getSelected(productColour)),r.append("productSeason",getSelected(productSeason)),r.append("productSize",productSize.value),r.append("productComposition",productComposition.value),r.append("productIsSale",translateBoolToInt(productIsSale.checked)),r.append("productPercent",productPercent.value),r.append("productPrice",productPrice.value),r.append("productPriceAfterSale",productPriceAfterSale.value),r.append("productIsAvailability",translateBoolToInt(productIsAvailability.checked)),t.send(r),t.onreadystatechange=function(){4==t.readyState&&(200!=t.status?(console.log(t.status+" : "+t.statusText),errorText.textContent="Ошибка"):1==t.responseText&&(window.location="../"))}}else errorText.textContent="Заполните все поля!"}function createCheckBox(e){var t=document.getElementById("size_chois");if(t){var o=!0,r=!1,n=void 0;try{for(var c,d=e[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var a=c.value,u=document.createElement("div"),i=document.createElement("input"),l=document.createElement("label");i.type="checkbox",i.value=a,i.name="size_chois",i.id="size_"+a,l.htmlFor="size_"+a,l.textContent=a,u.appendChild(l),u.appendChild(i),t.appendChild(u)}}catch(e){r=!0,n=e}finally{try{!o&&d.return&&d.return()}finally{if(r)throw n}}}}window.onload=init;function init(){createCheckBox(sizeName);var e=!0,t=!1,o=void 0;try{for(var r,n=sizeCheckbox[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){r.value.addEventListener("change",function(e){var t=function(e){e.length>=1?(e.sort(function(e,t){return e>t?1:-1}),productSize.value=e.join(", ")):0==e.length&&(productSize.value="")};e.target.checked?(sizeArr.push(parseInt(e.target.value)),t(sizeArr)):(sizeArr.splice(sizeArr.indexOf(parseInt(e.target.value)),1),t(sizeArr))},!1)}}catch(e){t=!0,o=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw o}}for(var c in compositions)window["composition_"+c]=c,window["composition_"+c]=new Composition(compositions[c].ru,compositions[c].eng,c),window["composition_"+c].init()}var Composition=function(){function e(t,o,r){_classCallCheck(this,e),this.composition_ru=t,this.composition=o,this.id=r,this.check=0,this.str="",this.count=0,this.container=document.getElementById("composition_chois")}return _createClass(e,[{key:"createLabel",value:function(e,t){var o=document.createElement("label");o.htmlFor=t,o.textContent=this.composition_ru,e.appendChild(o)}},{key:"createInput",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=document.createElement("input");n.type=t,n.id=t+"_"+this.id,n.value=o,null!==r&&(n.onclick=r),"checkbox"==t&&this.createLabel(e,t+"_"+this.id),e.appendChild(n)}},{key:"init",value:function(){var e=document.createElement("div");this.container&&(e.className="composition_box",this.container.appendChild(e),this.createInput(e,"checkbox"),this.createInput(e,"text"),this.createInput(e,"button","Добавить",function(e){var t=e.target.id.split("_")[1];window["composition_"+t].add()}),this.createInput(e,"button","Удалить",function(e){var t=e.target.id.split("_")[1];window["composition_"+t].delete()}))}},{key:"renderValue",value:function(e){productComposition.value=e.join(", ")}},{key:"add",value:function(){var e=document.getElementById("checkbox_"+this.id),t=document.getElementById("text_"+this.id).value;e.checked&&0==this.check&&t>=1&&t<=100&&(this.str=this.composition_ru+"-"+t+"%",this.count=t,this.check=1,productCompositionArr.push(this.str),this.renderValue(productCompositionArr))}},{key:"delete",value:function(){var e=document.getElementById("checkbox_"+this.id),t=document.getElementById("text_"+this.id);e.checked&&1==this.check&&e.checked&&(productCompositionArr.splice(productCompositionArr.indexOf(this.str),1),this.renderValue(productCompositionArr),e.checked=!1,t.value="",this.check=0)}}]),e}();productPercent&&productPercent.addEventListener("keyup",function(e){var t=e.target.value;isSaleCheck&&(productPriceAfterSale.value=0!=t?getSale(productPrice.value,t):productPrice.value)},!1),productPrice&&productPrice.addEventListener("keyup",function(e){var t=e.target.value;productPriceAfterSale.value=isSaleCheck?0!=productPercent.value?Math.floor(getSale(t,productPercent.value)):t:productPrice.value},!1),productIsSale.addEventListener("change",function(e){e.target.checked?(isSaleCheck=!0,productPriceAfterSale.value=0!=productPercent.value?Math.floor(getSale(productPrice.value,productPercent.value)):productPrice.value):(isSaleCheck=!1,productPriceAfterSale.value=productPrice.value)},!1),productPriceAfterSale&&productPriceAfterSale.addEventListener("keyup",function(e){var t=e.target.value;productPercent.value=getPercent(productPrice.value,t)},!1);