"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Catalog=function(){function t(e,i){_classCallCheck(this,t),this.total_pages,this.items,this.currentPage=1,this.url=e,this.method=i,this.total_items=1,this.item_on_page=1,this.countItems=document.getElementById("countItems"),this.productInCart,this.catalogBtnCart,this.selectedProductSize,this.currentProductSize,this.idCartItem,this.countItemsPerPage=0,this.animationAOS=["fade-up","fade-in","fade-right","fade-left","fade-up-right","fade-up-left","fade-down-right","fade-down-left"],this.state={categoryFilter:[],brandFilter:[],seasonFilter:[],isSaleFilter:"",minPrice:0,maxPrice:0,sortBy:"sortByNewest",searchValue:""}}return _createClass(t,[{key:"randomInteger",value:function(t,e){return Math.round(t-.5+Math.random()*(e-t+1))}},{key:"init",value:function(){this.getData(this.currentPage,this.state)}},{key:"receivingВata",value:function(t,e){var i=this;return new Promise(function(a,r){"POST"==i.method?$.ajax({url:i.url,method:i.method,data:{page:t,state:e}}).done(a).fail(r):"GET"==i.method&&$.ajax({url:i.url,method:i.method}).done(a).fail(r)})}},{key:"setItems",value:function(t){if("object"==(void 0===t?"undefined":_typeof(t)))try{this.items=t,this.total_items=this.items.total_item,this.item_on_page=this.items.record_per_page,this.currentPage=this.items.current_page}catch(t){console.log(t)}}},{key:"changeSize",value:function(){var t=this,e=!0,i=!1,a=void 0;try{for(var r,n=function(){var e=r.value;e.addEventListener("change",function(i){var a=i.target,r=a.getAttribute("data-size"),n=a.getAttribute("data-id");t.currentProductSize=!0===a.checked?r:null,t.idCartItem=!0===a.checked?n:null;var o=!0,s=!1,c=void 0;try{for(var l,u=t.catalogBtnCart[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var d=l.value,h=d.getAttribute("data-id");e.classList.contains("catalog-item-in-cart")?h==n&&($(e).addClass("in-cart"),d.setAttribute("data-size",r),d.innerText="Удалить из корзины"):h==n&&($(e).removeClass("in-cart"),d.setAttribute("data-size",""),d.innerText="Добавить в корзину")}}catch(t){s=!0,c=t}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}})},o=this.selectedProductSize[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)n()}catch(t){i=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw a}}}},{key:"addBtnEvent",value:function(){var t=this;this.catalogBtnCart=document.querySelectorAll(".catalog-add-to-cart");var e=!0,i=!1,a=void 0;try{for(var r,n=function(){var e=r.value;e.addEventListener("click",function(i){var a=i.target.dataset.id;null!=t.currentProductSize&&a==t.idCartItem&&(0!=e.getAttribute("data-size").length?$.ajax({url:"../cart/deleteProductInCart",type:"POST",data:{id:t.idCartItem,size:t.currentProductSize}}).done(function(){window.location.reload()}).fail(function(){errorSet(errorText,"Ошибка при удалении из корзины")}):$.ajax({url:"../cart/addProduct",type:"POST",data:{id:t.idCartItem,size:t.currentProductSize}}).done(function(){window.location.reload()}).fail(function(){console.log("Error")}))})},o=this.catalogBtnCart[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)n()}catch(t){i=!0,a=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw a}}}},{key:"getData",value:async function(t,e){var i=this;if("POST"==this.method)try{var a=await this.receivingВata(t,e);this.setItems($.parseJSON(a)),$(".catalog-items-list").html(""),void 0!=this.items.item?(this.items.productInCart&&(this.productInCart=this.items.productInCart),this.itemsRender(this.items.item),this.selectedProductSize=document.querySelectorAll('input[name="size-item"]'),this.changeSize(),this.addBtnEvent(),this.countItemsPerPage=Object.keys(this.items.item).length,this.countItems.innerText=this.currentCountItems(this.countItemsPerPage,this.currentPage,this.item_on_page,this.total_items),$(".paginations").pagination({items:this.total_items,itemsOnPage:this.item_on_page,cssStyle:"dark-theme",prevText:"",nextText:"",hrefTextPrefix:"",currentPage:this.currentPage,onPageClick:function(t){setTimeout(function(){i.getData(t,i.state)},500)}})):this.items.length>=1?this.itemsRender(this.items):this.countItemsRender(0)}catch(t){throw this.countItemsRender("Error"),new Error(t)}else if("GET"==this.method){a=await this.receivingВata(t,e);console.log($.parseJSON(a))}}},{key:"itemsRender",value:function(t){var e=this,i=!0,a=!1,r=void 0;try{for(var n,o=function(){var t=n.value,i="",a="";e.productInCart&&e.productInCart[t.id]&&e.productInCart[t.id].size.sort(),c=t.size.split(", "),1==t.is_sale?(i='<p class="item-old-price">'+t.price+' руб.</p><p class="item-sale-price">'+t.sale_price+" руб.</p>",a='<div class="item-sale-percent"><p>'+t.percentSale+"%</p></div>"):i="<p>"+t.price+" руб.</p>",$(".catalog-items-list").append('\n                    <div class="catalog-item" data-aos="'+e.animationAOS[e.randomInteger(0,7)]+'" data-aos-duration="500">\n                        <div class="shadow"></div>\n                        <img src="'+t.image+'" alt="Item-'+t.id+'">\n                        '+a+'\n                        <div class="image_overlay"></div>\n                        <div class="add_to_cart product_opacity catalog-add-to-cart" data-id="'+t.id+'" data-size="">Добавить в корзину</div>\n                        <div class="add_to_compare product_opacity" data-id="'+t.id+'" data-size="">Отложить</div>\n                        <div class="product-info">         \n                            <div class="info-container">\n                                <div class="info-container-header">\n                                    <div class="product-name">\n                                        <a href="../product/'+t.id+'">\n                                        <p class="product-title">'+t.name+" "+t.article+'</p>\n                                        <p class="product-brand">'+t.brand_name+'</p>\n                                        </a> \n                                    </div>\n                                    <div class="product-price">'+i+'</div>\n                                </div>\n                                <div class="product-hide-info">\n                                    <strong>Размер</strong>\n                                    <div class="product-size">'+c.map(function(i){var a="";if(e.productInCart&&e.productInCart[t.id]){var r=!0,n=!1,o=void 0;try{for(var s,c=e.productInCart[t.id].size[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){s.value==i&&(a="catalog-item-in-cart")}}catch(t){n=!0,o=t}finally{try{!r&&c.return&&c.return()}finally{if(n)throw o}}}return'<input type="radio" class="'+a+'" name="size-item" id=\'size-item_'+t.id+"_"+i+"' data-id=\""+t.id+'" data-size="'+i+"\">\n                                                    <label for='size-item_"+t.id+"_"+i+"' data-id=\""+t.id+'" data-size="'+i+'" class="size-item">'+i+"</label>"})+'\n                                    </div>\n                                    <strong>Состав</strong>\n                                    <div class="product-compositions">\n                                        '+t.composition+"\n                                    </div>\n                                </div>                       \n                            </div>                         \n                        </div>\n                    </div>\n                ")},s=t[Symbol.iterator]();!(i=(n=s.next()).done);i=!0){var c;o()}}catch(t){a=!0,r=t}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}}},{key:"countItemsRender",value:function(t){"Error"==t?($(".catalog-items-list").html(""),$(".catalog-items-list").append("<h1>Список пуст</h1>"),this.countItems.innerText=0):0==t&&($(".catalog-items-list").append("<h1>Список пуст</h1>"),this.countItems.innerText=0)}},{key:"currentCountItems",value:function(t,e,i,a){if(0!=this.countItemsPerPage){var r=i*(e-1)+1;return"Показано с "+r+" по "+(r-1+t)+" из "+a}return"0"}}]),t}(),Filter=function(){function t(e){_classCallCheck(this,t),this.minPrice=document.getElementById("minPrice"),this.maxPrice=document.getElementById("maxPrice"),this.categoryList=document.getElementsByName("categoryList"),this.brandList=document.getElementsByName("brandList"),this.seasonList=document.getElementsByName("seasonList"),this.searchInput=document.getElementById("searchFilter_input"),this.searchBtn=document.getElementById("searchFilterBtn"),this.filterIsSale=document.getElementById("filterIsSale"),this.sortingList=document.getElementsByName("sortBy"),this.checkPrice=this.checkPrice.bind(this),this.obj=e}return _createClass(t,[{key:"init",value:function(){try{this.checkUndefined(this.minPrice,this.maxPrice)&&(this.obj.state.minPrice=minPrice.value,this.obj.state.maxPrice=maxPrice.value,this.filterPrice()),this.checkUndefined(this.categoryList,this.brandList,this.seasonList)&&this.filterCategory(),this.checkUndefined(this.searchInput,this.searchBtn)&&this.filterSearch(),this.checkUndefined(this.filterIsSale)&&this.filterSale(),this.checkUndefined(this.sortingList)&&this.sorting()}catch(t){console.log(t)}}},{key:"checkUndefined",value:function(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var a=!0,r=!1,n=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){return void 0!=o.value}}catch(t){r=!0,n=t}finally{try{!a&&s.return&&s.return()}finally{if(r)throw n}}}},{key:"checkPrice",value:function(t){return!(""==t||!t.match(/^\d+$/))}},{key:"sorting",value:function(){var t=this,e=!0,i=!1,a=void 0;try{for(var r,n=this.sortingList[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){r.value.addEventListener("change",function(e){t.obj.state.sortBy=e.target.value,t.obj.currentPage=1,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)},!1)}}catch(t){i=!0,a=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw a}}}},{key:"filterPrice",value:function(){var t=this;this.minPrice.addEventListener("change",function(e){var i=e.target.value;t.checkPrice(i)&&(t.obj.state.minPrice=i,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500))},!1),this.maxPrice.addEventListener("change",function(e){var i=e.target.value;t.checkPrice(i)&&(t.obj.state.maxPrice=i,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500))},!1)}},{key:"filterCategory",value:function(){var t=this,e=!0,i=!1,a=void 0;try{for(var r,n=this.categoryList[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){r.value.addEventListener("change",function(e){var i=e.target;if(i.checked)t.obj.currentPage=1,t.obj.state.categoryFilter.push(i.value),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500);else if(!i.checked){t.obj.currentPage=1;var a=t.obj.state.categoryFilter.indexOf(i.value);t.obj.state.categoryFilter.splice(a,1),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)}},!1)}}catch(t){i=!0,a=t}finally{try{!e&&n.return&&n.return()}finally{if(i)throw a}}var o=!0,s=!1,c=void 0;try{for(var l,u=this.brandList[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){l.value.addEventListener("change",function(e){var i=e.target;if(i.checked)t.obj.currentPage=1,t.obj.state.brandFilter.push(i.value),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500);else if(!i.checked){t.obj.currentPage=1;var a=t.obj.state.brandFilter.indexOf(i.value);t.obj.state.brandFilter.splice(a,1),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)}},!1)}}catch(t){s=!0,c=t}finally{try{!o&&u.return&&u.return()}finally{if(s)throw c}}var d=!0,h=!1,m=void 0;try{for(var f,g=this.seasonList[Symbol.iterator]();!(d=(f=g.next()).done);d=!0){f.value.addEventListener("change",function(e){var i=e.target;if(i.checked)t.obj.currentPage=1,t.obj.state.seasonFilter.push(i.value),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500);else if(!i.checked){t.obj.currentPage=1;var a=t.obj.state.seasonFilter.indexOf(i.value);t.obj.state.seasonFilter.splice(a,1),setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)}},!1)}}catch(t){h=!0,m=t}finally{try{!d&&g.return&&g.return()}finally{if(h)throw m}}}},{key:"filterSearch",value:function(){var t=this;this.searchBtn.addEventListener("click",function(){var e=t.searchInput.value;0==e.length?(t.obj.state.searchValue="",t.obj.currentPage=1,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)):e.length>=3&&e.length<=20&&(e.match(/[^a-zA-Zа-яА-Я0-9]/g)||(t.obj.state.searchValue="%"+e+"%",t.obj.currentPage=1,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)))})}},{key:"filterSale",value:function(){var t=this;this.filterIsSale.addEventListener("change",function(e){var i=e.target;i.checked?(t.obj.state.isSaleFilter=1,t.obj.currentPage=1,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500)):i.checked||(t.obj.state.isSaleFilter="",t.obj.currentPage=1,setTimeout(function(){t.obj.getData(t.obj.currentPage,t.obj.state)},500))},!1)}}]),t}();